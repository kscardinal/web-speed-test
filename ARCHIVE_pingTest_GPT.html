<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sonnaz Group | Ping Test</title>
  <style>
    #ping-text {
      font-size: 2em;
      font-weight: bold;
      transition: color 0.2s;
    }
  </style>
</head>
<body>
    <div class="body-container">
        <h1>Ping Test</h1>
        <p id="ping-text">Click "Test Ping"</p>
        <button id="ping-test-button">Test Ping</button>
    </div>

<script>
const host = 'https://api.github.com'; // Must support CORS
const pingText = document.getElementById('ping-text');
const pingButton = document.getElementById('ping-test-button');

function getColorForPing(ms) {
    // Map 20-200ms to 0-1
    const clamped = Math.min(Math.max(ms, 20), 200);
    const ratio = (clamped - 20) / (200 - 20);

    // Interpolate green (0,255,0) → yellow (255,255,0) → red (255,0,0)
    let r, g;
    if (ratio < 0.5) {
        // Green → Yellow
        r = Math.round(255 * (ratio * 2));
        g = 255;
    } else {
        // Yellow → Red
        r = 255;
        g = Math.round(255 * (1 - (ratio - 0.5) * 2));
    }
    return `rgb(${r},${g},0)`;
}

async function pingOnce(host) {
    const start = performance.now();
    await fetch(host, { method: 'HEAD', cache: 'no-cache' });
    const end = performance.now();
    return end - start;
}

pingButton.addEventListener('click', async () => {
    pingButton.disabled = true;
    const pingTimes = [];
    const interval = 100; // ms
    const duration = 10000; // 10 seconds
    const startTime = performance.now();

    while (performance.now() - startTime < duration) {
        try {
            const time = await pingOnce(host);
            pingTimes.push(time);

            // Compute average
            const avg = pingTimes.reduce((a,b) => a+b, 0) / pingTimes.length;
            pingText.textContent = `${avg.toFixed(2)} ms`;
            pingText.style.color = getColorForPing(avg);

        } catch (err) {
            console.error("Ping failed:", err);
        }

        await new Promise(resolve => setTimeout(resolve, interval));
    }

    pingButton.disabled = false;
});
</script>
</body>
</html>
